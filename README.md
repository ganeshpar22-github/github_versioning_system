Version Number Generator (Cloud Native)

This repository hosts the modern, reliable, and flexible solution for managing and publishing the Crew Integration System release versions. It removes all legacy BER infrastructure dependencies and uses a fully automated GitHub Actions pipeline.
1. High-Level Architecture
The system is a Static Site Generator (SSG) approach powered by GitHub.
Data Source: Each release branch has a simple /bin/branch.nfo file containing its start date.
Orchestration: A central utility script (release-orchestrator.sh) runs daily in the main branch, collecting all version data.
Publication: GitHub Pages hosts the generated release.html (for humans) and release.json (for systems).
Automation: A GitHub Workflow manages the entire process, running validation checks and deploying automatically.
2. Versioning Logic
The new versioning pattern is <year>.<release>.<weeks>.<days>.
Components:
Year/Release: Taken from the branch name (e.g., 2025.1).
Weeks: The number of full weeks passed since the branch started.
Days: The number of days passed since the last full week started (resets weekly, 0-6).
Special Version Numbers:
Master Infinity (0.0.0): Used in the max-version field for parameters that should be active indefinitely in the main branch.
Release Infinity (X.X.999): Used as the max-version in release branches. This guarantees parameters stay active only within that specific release cycle.
Next Release Start (X.X.1000): Used for closing parameters in one release without affecting the next one.
3. Branch Structure and Naming Rules
main Branch:
Purpose: The default branch. Contains all documentation (README.md), CI/CD configurations, the orchestrator script (release-orchestrator.sh), and the static HTML source files (index.html).
Versioning: Follows the X.Y.0.Days pattern.
release/crew-YYYY.R Branches:
Purpose: Long-running branches for specific release cycles (e.g., release/crew-2025.1).
Content: Contains the source code, /bin/branch.nfo, and /bin/version.sh.
Versioning: Follows the X.Y.Weeks.Days pattern.
4. How the Daily Version Generation Works
The process is fully automated via GitHub Actions:
Trigger: The workflow runs daily at 00:05 UTC (or manually via the UI button).
Checkout: The worker downloads the entire repository history (fetch-depth: 0).
Data Collection: release-orchestrator.sh runs, loops through all release branches, and calculates their current version numbers.
Validation: The script validates the generated JSON using jq. If validation fails, the process stops here.
Artifact Creation: The finalized release.html and release.json are packaged.
Deployment: The deployment job runs only if the validation succeeded, pushing the new files to GitHub Pages.
5. How HTML and JSON are Produced
Both files are generated by the release-orchestrator.sh script. The script compiles all data first, then uses basic shell commands (echo, cat <<EOF) to stream the content directly into site_output/release.html and site_output/release.json using the legacy formats required.
6. Developer Guide: Adding New Release Branches
To maintain the correct version logic when cutting a new branch:
Create the Branch: Create a new branch from main named release/crew-YYYY.R (e.g., release/crew-2026.1).
Set Anchor Date: In the new branch, update the date in /bin/branch.nfo to be 7 days prior to today's date. (This ensures the branch starts at X.Y.1.0 instead of X.Y.0.0).
Update main Branch Anchor: Switch back to the main branch and update the hardcoded variables in release-orchestrator.sh for the next Master cycle:
MASTER_PREFIX="2026.2" (incremented)
MASTER_ANCHOR_DATE="YYYY-MM-DD" (today's date)
7. Troubleshooting Section
Problem	Cause	Solution
Workflow fails with "HEAD" error	version.sh cannot find the branch name in the CI environment.	Ensure you are passing the GIT_BRANCH_NAME variable from the orchestrator script to the version script, as documented in the codebase.
JSON file has extra commas (validation fails)	A bug in the orchestrator script's JSON comma logic.	Verify the FIRST_ENTRY logic or use the "comma-first" approach for the loop.
Site won't update, Deploy step "skipped"	The previous job (generate-version) failed its validation check.	Check the logs of the failed job and fix the root cause (e.g., a bad date in a /bin/branch.nfo file).
Deployment fails with "Permissions Error"	The workflow token doesn't have access.	Ensure pages: write and id-token: write are present in the deploy job definition.